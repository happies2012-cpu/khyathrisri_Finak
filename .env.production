# Production Environment Configuration

## ðŸŒ Environment Variables

### Copy this to your `.env` file for production deployment:

```bash
# Application Configuration
NODE_ENV=production
PORT=5173

# Database Configuration
DATABASE_URL="postgresql://username:password@your-host:5432/your_database"

# JWT Configuration
JWT_SECRET="your-super-secure-jwt-secret-key-for-production"
JWT_EXPIRES_IN=7d

# OAuth Configuration
GOOGLE_CLIENT_ID="your-google-oauth-client-id"
GOOGLE_CLIENT_SECRET="your-google-oauth-client-secret"

# Application URLs
APP_URL="https://your-domain.com"
API_URL="https://api.your-domain.com"

# Email Configuration (SMTP)
SMTP_HOST="smtp.gmail.com"
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER="your-email@gmail.com"
SMTP_PASS="your-app-specific-password"

# Payment Configuration (Stripe)
STRIPE_PUBLISHABLE_KEY="pk_live_your-stripe-publishable-key"
STRIPE_SECRET_KEY="sk_live_your-stripe-secret-key"
STRIPE_WEBHOOK_SECRET="your-stripe-webhook-secret"

# File Upload Configuration
UPLOAD_MAX_SIZE=10485760
UPLOAD_ALLOWED_TYPES="jpg,jpeg,png,gif,pdf,zip"

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# Redis Configuration (Optional)
REDIS_URL="redis://your-redis-host:6379"

# Analytics (Optional)
GOOGLE_ANALYTICS_ID="GA_MEASUREMENT_ID"

# Logging
LOG_LEVEL=info
LOG_FILE_PATH="./logs/app.log"
```

## ðŸ—„ Database Setup

### PostgreSQL Production Setup

#### Option 1: Managed Database (Recommended)
```bash
# Vercel Postgres
# Add PostgreSQL database in Vercel dashboard
# Connection string will be provided automatically

# Railway Postgres
# Add PostgreSQL addon in Railway dashboard
# Connection string provided automatically

# Supabase (Alternative)
# Use your existing Supabase project
# Connection string in Supabase settings
```

#### Option 2: Self-Hosted Database
```bash
# Install PostgreSQL on server
sudo apt update && sudo apt install postgresql postgresql-contrib

# Create database and user
sudo -u postgres psql
CREATE DATABASE hosting_platform;
CREATE USER hosting_user WITH PASSWORD 'secure_password';
GRANT ALL PRIVILEGES ON DATABASE hosting_platform TO hosting_user;

# Update .env with connection string
DATABASE_URL="postgresql://hosting_user:secure_password@your-server-ip:5432/hosting_platform"
```

#### Option 3: Cloud Database
```bash
# AWS RDS
# Create RDS PostgreSQL instance
# Configure security groups and VPC
# Use provided connection string

# Google Cloud SQL
# Create Cloud SQL PostgreSQL instance
# Configure authorized networks
# Use provided connection string

# Azure Database
# Create Azure PostgreSQL server
# Configure firewall rules
# Use provided connection string
```

### Database Migration
```bash
# Generate Prisma client
npx prisma generate

# Push schema to production
npx prisma db push

# Seed initial data (optional)
npx prisma db seed
```

## ðŸš€ Deployment Platforms

### 1. Vercel Deployment

#### Prerequisites
- Vercel account
- GitHub connected to Vercel
- Production environment variables set

#### Deployment Steps

1. **Install Vercel CLI**
```bash
npm i -g vercel
```

2. **Login to Vercel**
```bash
vercel login
```

3. **Deploy Frontend**
```bash
# Deploy frontend to Vercel
vercel --prod

# Link existing project
vercel link
vercel --prod
```

4. **Configure Environment Variables**
```bash
# Set environment variables in Vercel dashboard
# or use CLI
vercel env add DATABASE_URL "your-connection-string"
vercel env add JWT_SECRET "your-jwt-secret"
vercel env add APP_URL "https://your-app.vercel.app"
```

5. **Backend Deployment Options**

**Option A: Vercel Functions**
```bash
# Deploy backend as serverless functions
cd server
vercel --prod

# Update API routes to handle serverless environment
```

**Option B: Separate Backend Server**
```bash
# Deploy backend to separate service (Railway, Render, etc.)
# Update CORS to allow Vercel frontend URL
```

#### Vercel Configuration Files

**vercel.json** (Create in project root):
```json
{
  "version": 2,
  "builds": [
    {
      "src": "package.json",
      "use": "@vercel/static-build",
      "config": {
        "distDir": "dist"
      }
    }
  ],
  "routes": [
    {
      "src": "/api/(.*)",
      "dest": "/api/$1"
    }
  ],
  "env": {
    "DATABASE_URL": "@database_url",
    "JWT_SECRET": "@jwt_secret"
  }
}
```

### 2. Coolify Deployment

#### Prerequisites
- Coolify account
- GitHub repository

#### Deployment Steps

1. **Deploy Frontend**
```bash
# Connect repository to Coolify
# Automatic deployment on push to main branch

# Manual deployment
npx coolify-cli deploy --dir dist
```

2. **Backend Deployment**
```bash
# Deploy backend separately
# Use Coolify's Docker deployment

# Create coolify.json
{
  "name": "ksfoundation-backend",
  "type": "docker",
  "dockerfilePath": "./server/Dockerfile",
  "env": {
    "DATABASE_URL": "@database_url",
    "JWT_SECRET": "@jwt_secret"
  }
}
```

3. **Environment Variables**
```bash
# Set in Coolify dashboard
# Coolify automatically encrypts sensitive values
```

#### Coolify Configuration

**coolify.json**:
```json
{
  "name": "ksfoundation",
  "type": "static",
  "build": {
    "env": {
      "NODE_ENV": "production"
    }
  }
}
```

### 3. Dokploy Deployment

#### Prerequisites
- Dokploy account
- Docker containerized application

#### Deployment Steps

1. **Create Docker Image**
```bash
# Build and push to registry
docker build -t username/ksfoundation .
docker push username/ksfoundation
```

2. **Deploy with Dokploy**
```bash
# Deploy using web interface
# Connect your Docker registry

# Or use CLI
dokploy deploy username/ksfoundation
```

3. **Dokploy Configuration**

**dokploy.yaml**:
```yaml
name: ksfoundation
type: static
build:
  context: .
  dockerfile: ./Dockerfile
  args:
    NODE_ENV: production
    DATABASE_URL: ${DATABASE_URL}
    JWT_SECRET: ${JWT_SECRET}
```

### 4. Railway Deployment

#### Prerequisites
- Railway account
- GitHub connected to Railway

#### Deployment Steps

1. **Deploy Frontend**
```bash
# Connect repository to Railway
# Railway will auto-detect and deploy

# Manual deployment
railway login
railway link
railway up
```

2. **Deploy Backend**
```bash
# Deploy backend as separate service
# Use railway.toml configuration
```

3. **Railway Configuration**

**railway.toml**:
```toml
[build]
builder = "NIXPACKS"

[deploy]
healthcheckPath = "/health"
healthcheckTimeout = 100
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[[services]]
name = "frontend"
source = "."
[runtime]
name = "node"
version = "18"
startCommand = "npm run preview"
healthcheckPath = "/"

[[services]]
name = "backend"
source = "./server"
[runtime]
name = "node"
version = "18"
startCommand = "npm start"
healthcheckPath = "/health"
```

## ðŸ”§ Production Build

### Frontend Build
```bash
# Build for production
npm run build

# Build with specific environment
NODE_ENV=production npm run build

# Analyze bundle size
npm run build --analyze
```

### Backend Build
```bash
# Build backend for production
cd server
npm run build

# Create production bundle
npm run build:production
```

## ðŸ—„ Database Connection Examples

### Prisma Configuration

**prisma/config.ts**:
```typescript
import { PrismaClient } from '@prisma/client';

const globalForPrisma = globalThis as unknown as {
  prisma: PrismaClient | undefined,
};

export const prisma = globalForPrisma.prisma || 
  new PrismaClient({
    datasources: {
      db: {
        url: process.env.DATABASE_URL,
      },
    },
  });

if (process.env.NODE_ENV !== 'production') {
  globalForPrisma.prisma = prisma;
}
```

### Connection Testing
```bash
# Test database connection
npx prisma db pull

# Verify schema
npx prisma generate

# Test connection
node -e "
const { PrismaClient } = require('@prisma/client');
const prisma = new PrismaClient({
  datasources: {
    db: {
      url: process.env.DATABASE_URL,
    },
  },
});

prisma.\$connect()
  .then(() => console.log('âœ… Database connected'))
  .catch((e) => console.error('âŒ Database connection failed:', e));
"
```

## ðŸ” Security Configuration

### SSL Certificates

#### Let's Encrypt (Free)
```bash
# Install Certbot
sudo apt install certbot python3-certbot-nginx

# Generate certificate
sudo certbot --nginx -d your-domain.com

# Auto-renewal
sudo crontab -e
0 12 * * * /usr/bin/certbot renew --quiet --nginx
```

#### Cloud SSL (Paid)
```bash
# AWS Certificate Manager
# Google Cloud SSL certificates
# Cloudflare SSL certificates
```

### Firewall Configuration
```bash
# UFW (Ubuntu)
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable

# AWS Security Groups
# Configure inbound rules for HTTP/HTTPS
# Allow access from application servers only
```

### Environment Security

```bash
# Secure environment variables
echo "DATABASE_URL=postgresql://..." >> .env
chmod 600 .env

# Use secret management services
# AWS Secrets Manager
# Google Secret Manager
# Azure Key Vault
```

## ðŸ“Š Monitoring & Logging

### Application Monitoring

#### Health Checks
```typescript
// server/health.ts
import { Request, Response } from 'express';
import { prisma } from './config/database';

export const healthCheck = async (req: Request, res: Response) => {
  try {
    await prisma.\$connect();
    
    res.status(200).json({
      status: 'healthy',
      timestamp: new Date().toISOString(),
      uptime: process.uptime(),
      memory: process.memoryUsage(),
      database: 'connected'
    });
  } catch (error) {
    res.status(503).json({
      status: 'unhealthy',
      timestamp: new Date().toISOString(),
      error: error.message
    });
  }
};
```

#### Logging Configuration
```typescript
// server/utils/logger.ts
import winston from 'winston';

export const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ 
      filename: process.env.LOG_FILE_PATH || './logs/app.log',
      maxsize: 5242880, // 5MB
      maxFiles: 5,
    }),
    new winston.transports.Console({
      format: winston.format.simple()
    })
  ],
});
```

### Performance Monitoring

#### Frontend Performance
```javascript
// src/utils/performance.ts
export const reportWebVitals = (metric) => {
  // Send to analytics service
  if (process.env.NODE_ENV === 'production') {
    gtag('event', metric.name, {
      value: metric.value,
      custom_map: { custom_parameter_1: metric.id }
    });
  }
};
```

#### Backend Performance
```typescript
// server/middleware/performance.ts
import { Request, Response, NextFunction } from 'express';

export const performanceMiddleware = (req: Request, res: Response, next: NextFunction) => {
  const start = Date.now();
  
  res.on('finish', () => {
    const duration = Date.now() - start;
    
    // Log slow requests
    if (duration > 1000) {
      logger.warn(`Slow request: ${req.method} ${req.path} - ${duration}ms`);
    }
  });
  
  next();
};
```

## ðŸ”„ CI/CD Pipeline

### GitHub Actions

**.github/workflows/deploy.yml**:
```yaml
name: Deploy to Production

on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm ci
      - run: npm run test
      - run: npm run build

  deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm ci
      - run: npm run build
      
      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
```

## ðŸ“± Domain Configuration

### DNS Settings

#### A Records
```bash
# Frontend (Vercel)
@ -> 76.76.19.217

# Backend (Separate server)
api -> 123.45.67.89

# Both (Docker)
@ -> 123.45.67.89
api -> 123.45.67.89
```

#### CNAME Records
```bash
# Custom domain
www -> your-app.vercel.app

# Subdomains
app -> your-app.vercel.app
api -> api.your-domain.com
```

### SSL Configuration
```bash
# Vercel provides automatic SSL
# Custom domain needs manual SSL setup

# Cloudflare (Recommended)
# Add domain to Cloudflare
# Enable SSL/TLS encryption
# Configure DNS records
```

## ðŸš¨ Troubleshooting

### Common Issues

#### Database Connection
```bash
# Connection timeout
# Check DATABASE_URL format
# Verify network accessibility
# Check database server status

# SSL errors
# Use sslmode=require in connection string
# Update CA certificates
```

#### Build Errors
```bash
# Memory issues
# Increase Node.js memory limit
NODE_OPTIONS="--max-old-space-size=4096"

# TypeScript errors
# Check type definitions
# Update dependencies
# Clear build cache
rm -rf node_modules/.cache
```

#### Deployment Issues
```bash
# Vercel deployment failures
# Check vercel.json configuration
# Verify environment variables
# Check build logs

# Coolify deployment issues
# Verify Docker configuration
# Check resource limits
# Review deployment logs
```

### Health Check Endpoints

```bash
# Frontend health
curl https://your-domain.com/api/health

# Backend health
curl https://api.your-domain.com/health

# Database health
curl -X POST https://api.your-domain.com/health/db
```

---

**Production Environment Setup for KSFOUNDATION**
